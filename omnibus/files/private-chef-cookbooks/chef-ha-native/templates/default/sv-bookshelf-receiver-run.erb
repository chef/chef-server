#!/bin/sh
exec 2>&1

# Don't allow bookshelf-receiver to come up if bookshelf is still
# running
if chef-server-ctl wait bookshelf -d -t10
then
    exec chpst -P -u <%= node['private_chef']['user']['username'] %> -U <%= node['private_chef']['user']['username'] %> rsync --daemon --no-detach --config <%= node['private_chef']['bookshelf-receiver']['dir'] %>/etc/rsyncd.conf --log-file /dev/stdout
else
    exit 1
fi
