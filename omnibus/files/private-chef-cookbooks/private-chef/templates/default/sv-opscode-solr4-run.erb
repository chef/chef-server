#!/bin/sh

/opt/opscode/bin/wait-for-rabbit

cd /opt/opscode/embedded/service/opscode-solr4/jetty

ulimit -n 50000

PROCESSOR=`uname -p`
if [ "$PROCESSOR" = "ppc64" -o "$PROCESSOR" = "ppc64le" ]; then
EMBEDDED_JAVA_HOME=/opt/opscode/embedded/jre/jre
else
EMBEDDED_JAVA_HOME=/opt/opscode/embedded/jre
fi

exec 2>&1
exec chpst -P -o 50000 -U <%= node['private_chef']['user']['username'] %> -u <%= node['private_chef']['user']['username'] %> /usr/bin/env PATH=/opt/opscode/embedded/bin:/opt/opscode/bin:$EMBEDDED_JAVA_HOME/bin:$PATH JAVA_HOME=$EMBEDDED_JAVA_HOME <%= node['private_chef']['opscode-solr4']['command'] %>

